ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE
, show_column_names = TRUE)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =TRUE
, show_column_names = TRUE)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE
, show_column_names = TRUE)
# Annotation
AnnoDF <- data.frame(c("ROBO2_Radial_Glia", "SLIT2_Radial_Glia", "ROBO2_Astrocyte","SEMA3E_Astrocyte","OL_like_Astrocyte"))
colnames(AnnoDF) <- c("Cluster")
AnnoDF$Cluster <- factor(AnnoDF$Cluster, levels = c("ROBO2_Radial_Glia", "SLIT2_Radial_Glia", "ROBO2_Astrocyte","SEMA3E_Astrocyte","OL_like_Astrocyte"))
colAnno <- HeatmapAnnotation(
df=AnnoDF,
show_annotation_name = c(TRUE,TRUE),
annotation_name_gp = gpar(fontsize = 12),
annotation_name_side = "left",
col = list(Cluster = c("ROBO2_Radial_Glia" = "#e2e700","SLIT2_Radial_Glia" = "#FFDAB9", "ROBO2_Astrocyte" = "#FFA500","SEMA3E_Astrocyte" = "#FF4F00","OL_like_Astrocyte" = "#C2A162")))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
nnoDF <- data.frame(c("ROBO2_Radial_Glia", "SLIT2_Radial_Glia", "ROBO2_Astrocyte","SEMA3E_Astrocyte","OL_like_Astrocyte"))
colnames(AnnoDF) <- c("Subcluster")
AnnoDF$Subcluster <- factor(AnnoDF$Subcluster, levels = c("ROBO2_Radial_Glia", "SLIT2_Radial_Glia", "ROBO2_Astrocyte","SEMA3E_Astrocyte","OL_like_Astrocyte"))
colAnno <- HeatmapAnnotation(
df=AnnoDF,
show_annotation_name = c(TRUE,TRUE),
annotation_name_gp = gpar(fontsize = 12),
annotation_name_side = "left",
col = list(Subcluster = c("ROBO2_Radial_Glia" = "#e2e700","SLIT2_Radial_Glia" = "#FFDAB9", "ROBO2_Astrocyte" = "#FFA500","SEMA3E_Astrocyte" = "#FF4F00","OL_like_Astrocyte" = "#C2A162")))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/RGL_Astrocyte/Unique_Motif_Enrichment.pdf", width = 8, height = 60)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/RGL_Astrocyte/Unique_Motif_Enrichment.pdf", width = 8, height = 40)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/RGL_Astrocyte/Unique_Motif_Enrichment.pdf", width = 8, height = 45)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
View(matrix_motif)
View(cols)
View(cols[[1]])
View(motif.df)
View(cols)
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(RGL_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
#motif.df[sig$motif.name,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
#motif.df <- motif.df[unique(motif),]
#rownames(motif.df) <- motif.df$motif
#motif.df$motif <- NULL
#return(motif.df)
})
View(sig.motif)
View(sig.motif[[1]])
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(RGL_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
#motif.df[sig$motif.name,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
motif.df <- motif.df[unique(motif),]
rownames(motif.df) <- motif.df$motif
motif.df$motif <- NULL
return(motif.df)
})
View(sig.motif[[1]])
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(RGL_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
motif.df[sig$motif.name,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment","p.adjust"]
motif.df <- motif.df[unique(motif),]
rownames(motif.df) <- motif.df$motif
motif.df$motif <- NULL
return(motif.df)
})
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(RGL_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
motif.df[sig$motif.name,k,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment","p.adjust"]
motif.df <- motif.df[unique(motif),]
rownames(motif.df) <- motif.df$motif
motif.df$motif <- NULL
return(motif.df)
})
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(RGL_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
#motif.df[sig$motif.name,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
#motif.df <- motif.df[unique(motif),]
#rownames(motif.df) <- motif.df$motif
#motif.df$motif <- NULL
#return(motif.df)
})
View(sig.motif)
View(sig.motif[[1]])
df3 <- data.frame(sig.motif)
View(matrix_motif)
View(cols)
# Annotation
AnnoDF <- data.frame(c("RG_like_OPC","OPC","COP","Astrocyte_like_OPC"))
colnames(AnnoDF) <- c("Subcluster")
AnnoDF$Subcluster <- factor(AnnoDF$Subcluster, levels = c("RG_like_OPC","OPC","COP","Astrocyte_like_OPC"))
colAnno <- HeatmapAnnotation(
df=AnnoDF,
show_annotation_name = c(TRUE,TRUE),
annotation_name_gp = gpar(fontsize = 12),
annotation_name_side = "left",
col = list(Subcluster = c("RG-like OPC" =  "#89CFF0","OPC" = "blue","COP" = "#0096FF","Astrocyte-like OPC"= "#40E0D0")))
RG_like_OPC <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/RG-like_OPC_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
OPC <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/OPC_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
COP <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/COP_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Astrocyte_like_OPC <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/Astrocyte-like_OPC_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
#make a list of DAP in each subcluster
OPC_Subcluster_MOTIF_list <- list(RG_like_OPC,OPC,COP,Astrocyte_like_OPC)
name.list <- c("RG_like_OPC","OPC","COP","Astrocyte_like_OPC")
#motif analysis
OPC_Astrocyte_Subcluster_MOTIF <- lapply(OPC_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(OPC_Astrocyte_Subcluster_MOTIF) <- name.list
OPC_Astrocyte_Subcluster_MOTIF_df <- lapply(name.list, function(y){
df <- OPC_Astrocyte_Subcluster_MOTIF[[y]]
df <- df[df$p.adjust < 0.05,]
df <- df[order(df$fold.enrichment, decreasing = TRUE),]
motif <- df$motif.name
return(motif)
}
)
motif <- unlist(OPC_Astrocyte_Subcluster_MOTIF_df) %>% unique()
motif.df <- as.data.frame(motif)
motif.df <- na.omit(motif.df)
rownames(motif.df) <- motif.df$motif
motif <- na.omit(motif)
cols <-lapply(name.list, function(z){
motif.df[z] <- 0
z.motif.df <- data.frame(OPC_Astrocyte_Subcluster_MOTIF[[z]])
sig <-data.frame(z.motif.df[z.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
motif.df[sig$motif.name,z]<- z.motif.df[z.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
motif.df <- motif.df[unique(motif),]
rownames(motif.df) <- motif.df$motif
motif.df$motif <- NULL
return(motif.df)
})
df2 <- data.frame(cols)
matrix_motif <- as.matrix(df2)
colnames(matrix_motif) <- colnames(df2)
rownames(matrix_motif) <- unique(motif)
matrix_motif = t(apply(df2, 1, scale))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
# Annotation
AnnoDF <- data.frame(c("RG_like_OPC","OPC","COP","Astrocyte_like_OPC"))
colnames(AnnoDF) <- c("Subcluster")
AnnoDF$Subcluster <- factor(AnnoDF$Subcluster, levels = c("RG_like_OPC","OPC","COP","Astrocyte_like_OPC"))
colAnno <- HeatmapAnnotation(
df=AnnoDF,
show_annotation_name = c(TRUE,TRUE),
annotation_name_gp = gpar(fontsize = 12),
annotation_name_side = "left",
col = list(Subcluster = c("RG_like_OPC" =  "#89CFF0","OPC" = "blue","COP" = "#0096FF","Astrocyte_like_OPC"= "#40E0D0")))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/OPC/Unique_Motif_Enrichment.pdf", width = 8, height = 40)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/OPC/Unique_Motif_Enrichment.pdf", width = 8, height = 35)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
Early_OL <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Oligo Enriched Motif/EarlyOligouniqueDAP_enrichedMotifs.xlsx", rowNames = TRUE)
RBFOX1_OL <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Oligo Enriched Motif/RBFOX1uniqueDAP_enrichedMotifs.xlsx", rowNames = TRUE)
OPALIN_OL <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Oligo Enriched Motif/OPALINuniqueDAP_enrichedMotifs.xlsx", rowNames = TRUE)
#make a list of DAP in each subcluster
OL_Subcluster_MOTIF_list <- list(Early_OL,RBFOX1_OL,OPALIN_OL)
name.list <- c("Early_OL","RBFOX1_OL","OPALIN_OL")
#motif analysis
Oligo_Astrocyte_Subcluster_MOTIF <- lapply(Oligo_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
#motif analysis
OL_Astrocyte_Subcluster_MOTIF <- lapply(OL_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(OL_Astrocyte_Subcluster_MOTIF) <- name.list
OL_Astrocyte_Subcluster_MOTIF_df <- lapply(name.list, function(y){
df <- OL_Astrocyte_Subcluster_MOTIF[[y]]
df <- df[df$p.adjust < 0.05,]
df <- df[order(df$fold.enrichment, decreasing = TRUE),]
motif <- df$motif.name
return(motif)
}
)
motif <- unlist(OL_Astrocyte_Subcluster_MOTIF_df) %>% unique()
motif.df <- as.data.frame(motif)
motif.df <- na.omit(motif.df)
rownames(motif.df) <- motif.df$motif
motif <- na.omit(motif)
cols <-lapply(name.list, function(z){
motif.df[z] <- 0
z.motif.df <- data.frame(OL_Astrocyte_Subcluster_MOTIF[[z]])
sig <-data.frame(z.motif.df[z.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
motif.df[sig$motif.name,z]<- z.motif.df[z.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
motif.df <- motif.df[unique(motif),]
rownames(motif.df) <- motif.df$motif
motif.df$motif <- NULL
return(motif.df)
})
df2 <- data.frame(cols)
matrix_motif <- as.matrix(df2)
colnames(matrix_motif) <- colnames(df2)
rownames(matrix_motif) <- unique(motif)
matrix_motif = t(apply(df2, 1, scale))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
# Annotation
AnnoDF <- data.frame(c("Early_OL","RBFOX1_OL","OPALIN_OL"))
colnames(AnnoDF) <- c("Subcluster")
AnnoDF$Subcluster <- factor(AnnoDF$Subcluster, levels = c("Early_OL","RBFOX1_OL","OPALIN_OL"))
colAnno <- HeatmapAnnotation(
df=AnnoDF,
show_annotation_name = c(TRUE,TRUE),
annotation_name_gp = gpar(fontsize = 12),
annotation_name_side = "left",
col = list(Subcluster = c("Early_OL" = "#3998f5","RBFOX1_OL" = "#8A2BE2","OPALIN_OL" = "#1A3EAB")))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Oligo/Unique_Motif_Enrichment.pdf", width = 8, height = 8)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Oligo/Unique_Motif_Enrichment.pdf", width = 8, height = 4)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Oligo/Unique_Motif_Enrichment.pdf", width = 8, height = 5)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(OL_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
#motif.df[sig$motif.name,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
#motif.df <- motif.df[unique(motif),]
#rownames(motif.df) <- motif.df$motif
#motif.df$motif <- NULL
#return(motif.df)
})
View(sig.motif)
RG_like_OPC <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/RG-like_OPC_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
OPC <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/OPC_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
COP <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/COP_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Astrocyte_like_OPC <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/OPC Enriched Motif/Astrocyte-like_OPC_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
#make a list of DAP in each subcluster
OPC_Subcluster_MOTIF_list <- list(RG_like_OPC,OPC,COP,Astrocyte_like_OPC)
name.list <- c("RG_like_OPC","OPC","COP","Astrocyte_like_OPC")
#motif analysis
OPC_Astrocyte_Subcluster_MOTIF <- lapply(OPC_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(OPC_Astrocyte_Subcluster_MOTIF) <- name.list
OPC_Astrocyte_Subcluster_MOTIF_df <- lapply(name.list, function(y){
df <- OPC_Astrocyte_Subcluster_MOTIF[[y]]
df <- df[df$p.adjust < 0.05,]
df <- df[order(df$fold.enrichment, decreasing = TRUE),]
motif <- df$motif.name
return(motif)
}
)
motif <- unlist(OPC_Astrocyte_Subcluster_MOTIF_df) %>% unique()
motif.df <- as.data.frame(motif)
motif.df <- na.omit(motif.df)
rownames(motif.df) <- motif.df$motif
motif <- na.omit(motif)
sig.motif <-lapply(name.list, function(k){
motif.df[k] <- 0
k.motif.df <- data.frame(OPC_Astrocyte_Subcluster_MOTIF[[k]])
sig <-data.frame(k.motif.df[k.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
#motif.df[sig$motif.name,k]<- k.motif.df[k.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
#motif.df <- motif.df[unique(motif),]
#rownames(motif.df) <- motif.df$motif
#motif.df$motif <- NULL
#return(motif.df)
})
View(sig.motif)
View(sig.motif[[2]])
#read in and clean SEURAT object
Oligo_harmony <- readRDS("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/objects/celltype_subsets/Immune_harmony_subcluster.rds")
#read in and clean SEURAT object
Immune_harmony <- readRDS("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/objects/celltype_subsets/Immune_harmony_subcluster.rds")
Immune_harmony@assays$RNA <- NULL
Immune_harmony@assays$SCT <- NULL
Immune_harmony@assays$peaksMACS2 <- NULL
DefaultAssay(Immune_harmony) <- "ATAC"
motifs24 <-readRDS("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/objects/motifs24.rds")
library(Matrix)
library(Seurat)
library(Signac)
library(patchwork)
library(tidyverse)
library(dplyr)
library(readr)
library(magrittr)
library(openxlsx)
library(harmony)
library(clustree)
library(motifmatchr)
library(JASPAR2024)
library(TFBSTools)
library(BSgenome.Hsapiens.UCSC.hg38)
library(venn)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
set.seed(6)
#add motif information to the object
Immune_harmony <- AddMotifs(Immune_harmony, genome = BSgenome.Hsapiens.UCSC.hg38, pfm = motifs24)
View(Immune_harmony)
Immune_harmony@active.ident
{
cluster_0 <- "Microglia"
cluster_1 <- "Fetal Microglia"
cluster_2 <- "Microglia"
cluster_3 <- "Macrophage"
cluster_4 <- "Microglia"
cluster_5 <- "Macrophage"
cluster_6 <- "Microglia"
cluster_7 <- "Microglia"
cluster_8 <- "Immune Oligo"
cluster_9 <- "Fetal Microglia"
cluster_10 <- "Fetal Microglia"
cluster_11 <- "Lymphatic Endothelial"
cluster_12 <- "Microglia" #metabolic
cluster_13 <- "Fetal Microglia"
cluster_14 <- "Lymphocyte"
cluster_15 <- "Immune Oligo"
}
#determine@0.6
Immune_harmony <- SetIdent(Immune_harmony, value = Immune_harmony@meta.data$SCT_snn_res.0.6)
new.cluster.ids <- c(cluster_0, cluster_1, cluster_2, cluster_3, cluster_4, cluster_5, cluster_6, cluster_7, cluster_8, cluster_9, cluster_10, cluster_11, cluster_12, cluster_13, cluster_14, cluster_15)
names(new.cluster.ids) <- levels(Immune_harmony)
Immune_harmony <- RenameIdents(Immune_harmony, new.cluster.ids)
Immune_harmony$Subtype <- Immune_harmony@active.ident
Immune_harmony@meta.data$Subtype <- factor(x = Immune_harmony@meta.data$Subtype, levels = c("Fetal Microglia", "Microglia", "Macrophage","Lymphocyte","Lymphatic Endothelial", "Immune Oligo"))
Immune_harmony <- SetIdent(Immune_harmony, value = Immune_harmony@meta.data$Subtype)
View(Immune_harmony)
immune_color <- c("Fetal Microglia" = "#FFB3BA", "Microglia" = "#FF6F61","Macrophage" = "#E75480", "Lymphocyte" = "darkred","Lymphatic Endothelial" = "#D5006D", "Immune Oligo" = "#D8BFD8")
DimPlot(Immune_harmony, reduction = "umap.rna", cols = immune_color)
DefaultAssay(Immune_harmony) <- "ATAC"
Immune_Subcluster_ATAC <- FindAllMarkers(Immune_harmony, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25, only.pos = TRUE)
Immune_Subcluster_ATAC <- FindAllMarkers(Immune_harmony, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25)
write.xlsx(Immune_Subcluster_ATAC, "/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/DEG/Immune/Immune_subcluster_ATAC_DAP_updated.xlsx", rowNames = TRUE)
table(Immune_harmony@active.ident)
saveRDS(Immune_harmony, "/igm/projects/HD-BAT_Wedemeyer/atlas/pons/objects/Immune_harmony_motifs24.rds")
View(Immune_Subcluster_ATAC)
#read in DAP in each subcluster
Fetal_Microglia <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Fetal_Microglia_DAP.xlsx", rowNames = T)
Macrophage <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Macrophage_DAP.xlsx", rowNames = T)
Lymphocyte <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphocyte_DAP.xlsx", rowNames = T)
Lymphatic Endothelial <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphatic_Endothelial_DAP.xlsx", rowNames = T)
Lymphatic_Endothelial <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphatic_Endothelial_DAP.xlsx", rowNames = T)
Immune_OL <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Immune_Oligo_DAP.xlsx", rowNames = T)
Immune_harmony_subcluster_DAP_list <- list(Fetal_Microglia,Macrophage,Lymphocyte,Lymphatic_Endothelial,Immune_OL)
names(Immune_harmony_subcluster_DAP_list) <- c("Fetal_Microglia", "Macrophage", "Lymphocyte","Lymphatic_Endothelial","Immune_OL")
#motif analysis
lapply(names(Immune_harmony_subcluster_DAP_list), function(name) {
x <- Immune_harmony_subcluster_DAP_list[[name]]
print(x)
top.da.peak <- rownames(x[x$p_val < 0.005 & x$pct.1 > 0.2, ])
enriched.motifs <- FindMotifs(
object = OPC_harmony,
features = top.da.peak
)
write.xlsx(
enriched.motifs,
file = paste0("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/", name, "_DAP_enrichedMotifs.xlsx"),
rowNames = TRUE
)
p <- MotifPlot(
object = Immune_harmony,
motifs = head(rownames(enriched.motifs))
)
ggsave(p, file=paste0("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Immune/", name, "_DAP_enrichedMotifs.pdf"), width = 6, height = 4)
})
#motif analysis
lapply(names(Immune_harmony_subcluster_DAP_list), function(name) {
x <- Immune_harmony_subcluster_DAP_list[[name]]
print(x)
top.da.peak <- rownames(x[x$p_val < 0.005 & x$pct.1 > 0.2, ])
enriched.motifs <- FindMotifs(
object = Immune_harmony,
features = top.da.peak
)
write.xlsx(
enriched.motifs,
file = paste0("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/", name, "_DAP_enrichedMotifs.xlsx"),
rowNames = TRUE
)
p <- MotifPlot(
object = Immune_harmony,
motifs = head(rownames(enriched.motifs))
)
ggsave(p, file=paste0("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Immune/", name, "_DAP_enrichedMotifs.pdf"), width = 6, height = 4)
})
gc()
Fetal_Microglia <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Fetal_Microglia_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Macrophage <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Macrophage_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Lymphocyte <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphocyte_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Lymphatic_Endothelial <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphatic_Endothelial_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Immune_OL <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Immune_OL_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
#make a list of DAP in each subcluster
Immune_Subcluster_MOTIF_list <- list(Fetal_Microglia,Macrophage,Lymphocyte,Lymphatic_Endothelial,Immune_OL)
names(Immune_Subcluster_MOTIF_list) <- c("Fetal_Microglia", "Macrophage", "Lymphocyte","Lymphatic_Endothelial","Immune_OL")
#motif analysis
Immune_Subcluster_MOTIF <- lapply(Immune_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(Immune_Subcluster_MOTIF) <- name.list
#make a list of DAP in each subcluster
Immune_Subcluster_MOTIF_list <- list(Fetal_Microglia,Macrophage,Lymphocyte,Lymphatic_Endothelial,Immune_OL)
names(Immune_Subcluster_MOTIF_list) <- c("Fetal_Microglia", "Macrophage", "Lymphocyte","Lymphatic_Endothelial","Immune_OL")
#motif analysis
Immune_Subcluster_MOTIF <- lapply(Immune_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(Immune_Subcluster_MOTIF_list) <- name.list
Fetal_Microglia <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Fetal_Microglia_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Macrophage <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Macrophage_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Lymphocyte <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphocyte_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Lymphatic_Endothelial <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Lymphatic_Endothelial_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
Immune_OL <- read.xlsx("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/tables/motif/Immune/Immune_OL_DAP_enrichedMotifs.xlsx", rowNames = TRUE)
#make a list of DAP in each subcluster
Immune_Subcluster_MOTIF_list <- list(Fetal_Microglia,Macrophage,Lymphocyte,Lymphatic_Endothelial,Immune_OL)
name.list <- c("Fetal_Microglia", "Macrophage", "Lymphocyte","Lymphatic_Endothelial","Immune_OL")
#motif analysis
Immune_Subcluster_MOTIF <- lapply(Immune_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(Immune_Subcluster_MOTIF_list) <- name.list
Immune_Subcluster_MOTIF_df <- lapply(name.list, function(y){
df <- Immune_Subcluster_MOTIF[[y]]
df <- df[df$p.adjust < 0.05,]
df <- df[order(df$fold.enrichment, decreasing = TRUE),]
motif <- df$motif.name
return(motif)
}
)
name.list <- c("Fetal_Microglia","Macrophage","Lymphocyte","Lymphatic_Endothelial","Immune_OL")
#motif analysis
Immune_Subcluster_MOTIF <- lapply(Immune_Subcluster_MOTIF_list, function(x) {
x <- x[,-(1:5)]
x <- x[,-(2)]
})
names(Immune_Subcluster_MOTIF) <- name.list
Immune_Subcluster_MOTIF_df <- lapply(name.list, function(y){
df <- Immune_Subcluster_MOTIF[[y]]
df <- df[df$p.adjust < 0.05,]
df <- df[order(df$fold.enrichment, decreasing = TRUE),]
motif <- df$motif.name
return(motif)
}
)
motif <- unlist(Immune_Subcluster_MOTIF_df) %>% unique()
motif.df <- as.data.frame(motif)
motif.df <- na.omit(motif.df)
rownames(motif.df) <- motif.df$motif
motif <- na.omit(motif)
cols <-lapply(name.list, function(z){
motif.df[z] <- 0
z.motif.df <- data.frame(Immune_Subcluster_MOTIF[[z]])
sig <-data.frame(z.motif.df[z.motif.df$p.adjust < 0.05,])
sig <- sig[order(sig$p.adjust, decreasing = F),]
motif.df[sig$motif.name,z]<- z.motif.df[z.motif.df$motif.name %in% sig$motif.name, "fold.enrichment"]
motif.df <- motif.df[unique(motif),]
rownames(motif.df) <- motif.df$motif
motif.df$motif <- NULL
return(motif.df)
})
df2 <- data.frame(cols)
matrix_motif <- as.matrix(df2)
colnames(matrix_motif) <- colnames(df2)
rownames(matrix_motif) <- unique(motif)
matrix_motif = t(apply(df2, 1, scale))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
# Annotation
AnnoDF <- data.frame(c("Fetal_Microglia", "Macrophage", "Lymphocyte","Lymphatic_Endothelial","Immune_OL"))
colnames(AnnoDF) <- c("Subcluster")
AnnoDF$Subcluster <- factor(AnnoDF$Subcluster, levels = c("Fetal_Microglia", "Macrophage", "Lymphocyte","Lymphatic_Endothelial","Immune_OL"))
colAnno <- HeatmapAnnotation(
df=AnnoDF,
show_annotation_name = c(TRUE,TRUE),
annotation_name_gp = gpar(fontsize = 12),
annotation_name_side = "left",
col = list(Subcluster = c("Fetal_Microglia" = "#FFB3BA" ,"Macrophage" = "#E75480", "Lymphocyte" = "darkred","Lymphatic_Endothelial" = "#D5006D", "Immune_OL" = "#D8BFD8")))
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Immune/Motif_Enrichment.pdf", width = 8, height = 40)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
pdf("/igm/projects/HD-BAT_Wedemeyer/atlas/pons/figures/plots/motif_analysis/Immune/Unique_Motif_Enrichment.pdf", width = 8, height = 35)
ComplexHeatmap::Heatmap(matrix_motif, cluster_columns=F,cluster_rows =FALSE, show_column_names = TRUE,top_annotation = colAnno)
dev.off()
history()
savehistory("/igm/projects/HD-BAT_Wedemeyer/atlas_formatted/PEDIA-BRAIN-Pons/analysis/motif_analysis.Rhistory")
savehistory("/igm/projects/HD-BAT_Wedemeyer/atlas_formatted/PEDIA-BRAIN-Pons/analysis/motif_analysis.txt")
savehistory("/igm/projects/HD-BAT_Wedemeyer/atlas_formatted/PEDIA-BRAIN-Pons/analysis/motif_analysis.txt")
